<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.happy.sqlExMapper.HpUserExMapper">
	
	<sql id="getIdBySid">(SELECT u.hp_user_id FROM hp_user u WHERE u.user_token=#{sid})</sql>
	
	<select id="getTokenByUserId" resultType="String" >
		SELECT u.user_token FROM hp_user u WHERE u.hp_user_id=#{hpUserId};
	</select>
	
	<select id="getUserByToken" resultType="com.happy.service.user.data.UserSimpleData" >
		SELECT u.* FROM hp_user u WHERE u.user_token=#{sid};
	</select>
	
	<select id="getSimpleUserByKey" resultType="com.happy.service.user.data.UserSimpleData" >
		SELECT u.hp_user_id,u.user_token,u.share_token,u.phone_no,u.approve_state,u.black_on,u.user_name,u.header_pic,u.gender,u.approve_num 
		FROM hp_user u WHERE 1=1 
		<if test="hpUserId !=null and hpUserId !=0"> AND u.hp_user_id=#{hpUserId}</if>
		<if test="sid !=null and sid !=''"> AND u.user_token=#{sid}</if>
	</select>
	
	<select id="getIdByShareToken" resultType="Long" >
		SELECT u.hp_user_id FROM hp_user u WHERE u.share_token=#{shareToken};
	</select>
	
	
	<select id="getUserlistPage" parameterType="com.happy.service.user.data.UserManageSearch" resultType="com.happy.service.user.data.UserSimpleData" >
		SELECT u.hp_user_id,u.hp_company_id,u.user_type,u.user_name,u.gender,u.phone_no,u.born_year,u.real_name,u.black_on,
		u.approve_state,u.header_pic,u.id_num,u.id_front_pic,u.id_back_pic,u.id_person_pic,u.create_time,u.regist_resource,
		u.invite_user_id,u.user_money,u.approve_num,u.vip_on,u.login_time,u.login_ip,c.com_name 
		FROM hp_user u LEFT JOIN hp_company c ON u.hp_company_id=c.hp_company_id 
		WHERE 1=1 
		<if test="phoneNo !=null and phoneNo !='' ">AND u.phone_no LIKE CONCAT('%',#{phoneNo},'%')</if>
		<if test="resource !=null and resource !=0 ">AND u.regist_resource=#{resource}</if>
		<if test="startTime !=null and startTime !=0 ">AND u.create_time &gt;=#{startTime}</if>
		<if test="endTime !=null and endTime !=0 ">AND u.create_time &lt;=#{endTime}</if>
		<if test="blackOn !=null ">AND u.black_on=#{blackOn}</if>
		<if test="userType !=null ">AND u.user_type=#{userType}</if>
		ORDER BY create_time desc
	</select>
	
	<select id="getUserCountByPhone" resultType="int" >
		SELECT COUNT(*) FROM hp_user u WHERE u.phone_no=#{phoneNo};
	</select>
</mapper>
